using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace ConsoleApp25
{
    internal class Program
    {
        static void Main(string[] args)
        {
            Game game = new Game();
            game.Menu();
        }
    }

    class Game
    {
        public void Menu()
        {
            Player player = new Player();
            Seller seller = new Seller();

            const string CommandShowProducts = "1";
            const string CommandBuyProduct = "2";
            const string CommandHeroShowInventory = "3";
            const string CommandExit = "4";

            bool isActive = true;

            while (isActive)
            {
                Console.Clear();
                Console.WriteLine(
                    CommandShowProducts + " - Показать товары.\n" +
                    CommandBuyProduct + " - Купить товары.\n" +
                    CommandHeroShowInventory + " - Показать Ваш ивнентарь.\n" +
                    CommandExit + " - Уйти.\n\n\n\n\n\n\n\n\n" +
                    "Ваш баланс - " + player.Money);
                string UserInput = Console.ReadLine();

                switch (UserInput)
                {
                    case CommandShowProducts:
                        ShowSellerProducts(seller);
                        break;
                    case CommandBuyProduct:
                        BuyProduct(seller, player);
                        break;
                    case CommandHeroShowInventory:
                        ShowHeroInventory(ref player);
                        break;
                    case CommandExit:
                        isActive = false;
                        break;
                    default:
                        Console.Clear();
                        break;
                }
            }
        }

        private void ShowSellerProducts(Seller seller)
        {
            Console.Clear();

            if(seller.Products != null)
            {
                for (int i = 0; i < seller.Products.Count; i++)
                {
                    seller.Products[i].ShowInfo();
                }
            }
            else
            {
                Console.WriteLine("У торговца не осталось товара");
            }
            Console.ReadKey();
        }

        private void ShowHeroInventory(ref Player player)
        {
            Console.Clear();

            if (player.Inventory != null)
            {
                for (int i = 0; i < player.Inventory.Count; i++)
                {
                    player.Inventory[i].ShowInfo();
                }
            }
            else
            {
                Console.WriteLine("В вашем инвентаре пусто");
            }
            Console.ReadKey();
        }

        private void BuyProduct(Seller seller, Player player)
        {
            if (seller.Products != null)
            {
                ShowSellerProducts(seller);
                Console.WriteLine("Ввидите название желаемого предмета: ");
                string userInput = Console.ReadLine();

                if (GetProduct(seller, userInput, out Product product, player) == true)
                {
                    if (IsEnoughMoney(product, player) == true)
                    {
                        player.SpendMoney(product.Price);
                        seller.GiveMoney(product.Price);
                        player.Inventory.Add(product);
                        seller.Products.Remove(product);
                        Console.WriteLine("Успешная покупка !");
                        Console.ReadKey();
                    }
                    else
                    {
                        Console.WriteLine("Недостаточно золота");
                        Console.ReadKey();
                    }
                }
            }
            else
            {
                Console.WriteLine("У торговца не осталось товара");
                Console.ReadKey();
            }
        }

        private bool GetProduct(Seller seller, string userInput, out Product produt, Player player)
        {
            foreach (var item in seller.Products)
            {
                if (userInput == item.Title)
                {
                    produt = item;
                    return true;
                }
            }
            produt = null;
            return false;
        }

        private bool IsEnoughMoney(Product product, Player player)
        {
            if(player.Money >= product.Price)
            {
                return true;
            }
            else
            {
                return false;
            }
        }
    }

    class Player
    {
        public int Money { get; private set; }
        public List<Product> Inventory { get; protected set; }

        public Player()
        {
            Money = 40000;
            Inventory = new List<Product>();
        }

        public void SpendMoney(int sum)
        {
            Money -= sum;
        }
    }

    class Seller
    {
        public int Money { get; private set; }
        public List<Product> Products { get; private set; }

        public Seller()
        {
            Money = 100000;
            List<Product> products = new List<Product>() { new Sword(), new Armor(), new Horse() };
            Products = products;
        }

        public void GiveMoney(int sum)
        {
            Money += sum;
        }
    }

    abstract class Product
    {
        public string Title { get; private set; }
        public int Price { get; private set; }

        public Product(string title, int price)
        {
            Title = title;
            Price = price;
        }   

        public virtual void ShowInfo()
        {
            Console.WriteLine(Title + " по цене - " + Price);
        }
    }

    class Sword : Product
    {
        public Sword() : base("Меч", 9000) { }
    }

    class Armor : Product
    {
        public Armor() : base("Доспех", 25000) { }
    }

    class Horse : Product
    {
        public Horse() : base("Конь", 12000) { }
    }
}
